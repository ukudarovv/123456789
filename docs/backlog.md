# AvtoMat MVP — Бэклог (Epic → User Story → Tasks → DoD)

| Epic | User Story | Tasks | DoD |
| --- | --- | --- | --- |
| E0 Правила/тексты | Как владелец, хочу зафиксировать бизнес-правила и RU/KZ тексты | Утвердить правила (wa.me у пользователя, индекс доверия шкала, форматы, категории, ближайший набор, цена тестов в settings); Собрать таблицу переводов RU/KZ для кнопок/сообщений/ошибок; Утвердить шаблоны WhatsApp (SCHOOL_CLIENT_MESSAGE, TESTS_OWNER_MESSAGE) | Документ правил + таблица переводов согласованы и лежат в репо |
| E1 Инфра/репо | Как разработчик, хочу поднять dev окружение одной командой на SQLite | Структура репо (bot/, srm_backend/, env примеры); Настройки Django на SQLite + .env.example; Миграции + сиды справочников; Логирование (структурные логи) | `python manage.py migrate` и сиды проходят; сервисы стартуют одной командой; README описывает шаги |
| E2 Backend SRM API | Как бот, хочу API для справочников, каталога и создания лида | Реализовать модели по схеме (dict_*, school, school_tariff, instructor, bot_user, lead, lead_status_history, analytics_event, project_setting, whatsapp_template, srm_user/profile); Сериализаторы/валидаторы; Эндпоинты: POST /api/leads, GET /api/dicts/*, GET /api/schools, GET /api/schools/{id}, GET /api/instructors, GET /api/settings; Авторизация service-token; Юнит/интеграционные тесты | Эндпоинты отдают 200/201, данные пишутся в SQLite, негативы дают 4xx |
| E3 Web-SRM (Admin/MVP UI) | Как менеджер автошколы, хочу видеть свои лиды, менять статусы и экспортировать | Django Admin/страницы: list фильтры (статус, тип, город, автошкола, период), поиск по имени/телефону; Ограничение видимости по school_id; Карточка лида с историей статусов и комментарием; Смена статуса пишет в lead_status_history; Экспорт CSV | Менеджер видит только свои лиды, владелец/админ — все; смена статуса логируется; CSV выгружается с фильтрами |
| E4 Telegram-бот | Как пользователь, хочу пройти 3 потока и оставить заявку | FSM: /start, выбор языка, главное меню; Flow SCHOOL: город→категория→формат→школы→карточка→тариф→форма→подтверждение→POST lead; Flow INSTRUCTOR: город→КПП→наличие прав→пол→список→карточка→форма→подтверждение→POST lead; Flow TESTS: экран цены→форма (Имя/ИИН/Тел/WA/Email)→подтверждение→POST lead→wa.me владельца; Генерация wa.me; валидации; кнопки Назад/Главное меню | Все 3 потока завершаются, лиды создаются, wa.me открывается с номером и текстом, навигация работает |
| E5 Аналитика | Как владелец, хочу видеть конверсию по шагам | Таблица analytics_event; Отправка событий: start_opened, language_selected, intent_selected, flow_selected, city_selected, category_selected, format_selected, school_opened, tariff_selected, lead_form_opened, lead_submitted, whatsapp_opened, error_shown; Просмотр/экспорт | События пишутся для всех потоков; по ним строится воронка (экспорт/просмотр) |
| E6 Тесты/приёмка | Как команда, хочу убедиться, что MVP работает по чек-листу | Тестовые данные (города, автошколы, тарифы, инструкторы); E2E позитив/негатив по потокам; Проверка ролей; Проверка RU/KZ текстов | Чек-лист закрыт, критических багов нет, лид виден в SRM после прохождения бота |
| E7 Деплой | Как владелец, хочу запустить MVP с HTTPS | Prod .env; Запуск backend + бота (polling/webhook); Nginx/HTTPS; Бэкап SQLite (snapshot + cron), план восстановления | Прод окружение доступно, бот отвечает, логи пишутся, бэкап создаётся по расписанию |

